import {
	async,
	ComponentFixture,
	TestBed
} from '@angular/core/testing';
import { FormsModule } from '@angular/forms';
import { PatrolPlan } from './patrol-plan.component';
import { HttpModule } from '@angular/http';
import { SharedModule } from '../shared/_shared.module';
import { RouterTestingModule } from '@angular/router/testing';
import { HubService } from '../shared/hub.service';
import { MockHubService } from '../test/mockHub.service';
import { AlarmService } from '../alarms/alarm.service';
import { PlatformService } from '../platforms/platform.service';
import { PatrolService } from '../patrols/patrol.service';
import { LocationFilterService } from '../shared/location-filter.service';
import { UserService } from '../shared/user.service';
import { MockUserService } from '../test/mockUser.service';
import { NavigationService } from '../shared/navigation.service';
import { HttpService } from '../shared/http.service';
import { MockHttpServiceAlarms } from '../test/alarms/mockHttp.service';
import { LocationFilterPipe } from '../shared/location-filter.pipe';
import { WindowService } from './../shared/window.service';
import { AppSettings } from '../shared/app-settings';
import { MediaService } from '../shared/media/media.service';
import * as moment from 'moment';

jasmine.DEFAULT_TIMEOUT_INTERVAL = 15000;

describe('Patrol plan component', ()=>{
    let fixture: ComponentFixture<PatrolPlan>;

    beforeEach(async(() => {
		TestBed.configureTestingModule({
			imports: [FormsModule, HttpModule, SharedModule, RouterTestingModule],
			declarations: [PatrolPlan],
            providers: [{ provide: HubService, useClass: MockHubService }, AlarmService, PlatformService, PatrolService, LocationFilterService, { provide: UserService, useClass: MockUserService },
						NavigationService, { provide: HttpService, useClass: MockHttpServiceAlarms },
						LocationFilterPipe, WindowService, AppSettings, MediaService]
		});
		TestBed.compileComponents();
	}));

    describe('-constructor', () => {
        it(':should create the component', () => {
            // Arrange
            fixture = TestBed.createComponent(PatrolPlan);

            // Act
            fixture.detectChanges();

            // Assert
            expect(fixture.componentInstance).toBeDefined();
        });
    });
    
    describe('-expandAll()', () => {
        beforeEach(async(() => {
            fixture = TestBed.createComponent(PatrolPlan);
            fixture.componentInstance.patrolInstance = JSON.parse('{"Type":0,"IsTemplate":false,"selected":false,"expanded":false,"dirtyToggle":false,"AreaType":1,"TemplateId":"26dd88ec-f2e4-4fc4-b8e0-b1f75a63d724","DisplayName":"safe","Description":null,"id":"5ddfda9e-3886-4331-b658-df33e5dc5812","LocationId":"37e4434b-0d2c-47d0-8bef-033ea5bd28a2","Version":0,"IsDeleted":false,"TenantId":"f6f59624-018f-4a9c-89b2-96213966e4ec","RunSetData":null,"UserName":"Johnny Frederick","LastUpdateTime":1509054044662,"InstanceId":"5ddfda9e-3886-4331-b658-df33e5dc5812","SubmittedTime":1509053984068,"StartedTime":1509053986000,"EndedTime":1509054043000,"PlatformId":"Gamma2Platform8","CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509054043000}],"Points":[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}],"AlarmIds":null,"notficationIsPaused":false}');
            fixture.componentInstance.patrolPoints = JSON.parse('[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}]');
            fixture.detectChanges();
        }));

        it(':should expand all checkpoints when all checkpoints are collapsed', () => {
            // Act
            fixture.componentInstance.expandAll();

            // Assert
            expect((fixture.componentInstance as any).expandedActionItem.length).toEqual((fixture.componentInstance as any).pointIds.length);
        });

        it(':should expand all checkpoints when some checkpoints are collapsed', () => {
            // Arrange
            (fixture.componentInstance as any).expandedActionItem = ['94b8824d-2546-470c-85cb-17bf0210a6c5'];
            fixture.detectChanges();

            // Act
            fixture.componentInstance.expandAll();

            // Assert
            expect((fixture.componentInstance as any).expandedActionItem.length).toEqual((fixture.componentInstance as any).pointIds.length);
        });
    });

    describe('-collapseAll()', () => {
        it(':should collapse all checkpoints when all checkpoints are expanded', () => {
            // Arrange
            fixture = TestBed.createComponent(PatrolPlan);
            fixture.componentInstance.patrolInstance = JSON.parse('{"Type":0,"IsTemplate":false,"selected":false,"expanded":false,"dirtyToggle":false,"AreaType":1,"TemplateId":"26dd88ec-f2e4-4fc4-b8e0-b1f75a63d724","DisplayName":"safe","Description":null,"id":"5ddfda9e-3886-4331-b658-df33e5dc5812","LocationId":"37e4434b-0d2c-47d0-8bef-033ea5bd28a2","Version":0,"IsDeleted":false,"TenantId":"f6f59624-018f-4a9c-89b2-96213966e4ec","RunSetData":null,"UserName":"Johnny Frederick","LastUpdateTime":1509054044662,"InstanceId":"5ddfda9e-3886-4331-b658-df33e5dc5812","SubmittedTime":1509053984068,"StartedTime":1509053986000,"EndedTime":1509054043000,"PlatformId":"Gamma2Platform8","CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509054043000}],"Points":[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}],"AlarmIds":null,"notficationIsPaused":false}');
            fixture.componentInstance.patrolPoints = JSON.parse('[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}]');
            fixture.detectChanges();
            fixture.componentInstance.expandAll();

            // Act
            fixture.componentInstance.collapseAll();
            fixture.detectChanges();

            // Assert
            expect((fixture.componentInstance as any).expandedActionItem.length).toEqual(0);
        });
    });

    describe('-getPoints()', () => {
        it(':should not crash with an empty list', () => {
            // Arrange
            fixture = TestBed.createComponent(PatrolPlan);
            fixture.componentInstance.patrolInstance = JSON.parse('{ "Type": 0, "IsTemplate": false, "selected": false, "expanded": false, "dirtyToggle": false, "AreaType": 1, "TemplateId": "26dd88ec-f2e4-4fc4-b8e0-b1f75a63d724", "DisplayName": "safe", "Description": null, "id": "5ddfda9e-3886-4331-b658-df33e5dc5812", "LocationId": "37e4434b-0d2c-47d0-8bef-033ea5bd28a2", "Version": 0, "IsDeleted": false, "TenantId": "f6f59624-018f-4a9c-89b2-96213966e4ec", "RunSetData": null, "UserName": "Johnny Frederick", "LastUpdateTime": 1509054044662, "InstanceId": "5ddfda9e-3886-4331-b658-df33e5dc5812", "SubmittedTime": 1509053984068, "StartedTime": 1509053986000, "EndedTime": 1509054043000, "PlatformId": "Gamma2Platform8", "CurrentStatus": 2, "StatusHistory": [ { "Status": 1, "ReportedTime": 1509053986000 }, { "Status": 2, "ReportedTime": 1509054043000 } ], "Points": [ ], "AlarmIds": null, "notficationIsPaused": false }');
            fixture.componentInstance.patrolPoints = JSON.parse('[]');
            
            // Act
            fixture.detectChanges();

            // Assert
            expect(fixture.componentInstance).toBeDefined();
        });

        it(':should filter out path points for a patrol instance', () => {
            // Arrange
            fixture = TestBed.createComponent(PatrolPlan);
            fixture.componentInstance.patrolInstance = JSON.parse('{"Type":0,"IsTemplate":false,"selected":false,"expanded":false,"dirtyToggle":false,"AreaType":1,"TemplateId":"26dd88ec-f2e4-4fc4-b8e0-b1f75a63d724","DisplayName":"safe","Description":null,"id":"5ddfda9e-3886-4331-b658-df33e5dc5812","LocationId":"37e4434b-0d2c-47d0-8bef-033ea5bd28a2","Version":0,"IsDeleted":false,"TenantId":"f6f59624-018f-4a9c-89b2-96213966e4ec","RunSetData":null,"UserName":"Johnny Frederick","LastUpdateTime":1509054044662,"InstanceId":"5ddfda9e-3886-4331-b658-df33e5dc5812","SubmittedTime":1509053984068,"StartedTime":1509053986000,"EndedTime":1509054043000,"PlatformId":"Gamma2Platform8","CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509054043000}],"Points":[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}],"AlarmIds":null,"notficationIsPaused":false}');
            fixture.componentInstance.patrolPoints = JSON.parse('[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}]');
            
            // Act
            fixture.detectChanges();

            // Assert
            expect((fixture.componentInstance as any).getPoints().length).toEqual(3);
        });

        it(':should not filter out path points for a patrol instance', () => {
             // Arrange
            fixture = TestBed.createComponent(PatrolPlan);
            fixture.componentInstance.showPathPoints = true;
            fixture.componentInstance.patrolInstance = JSON.parse('{"Type":0,"IsTemplate":false,"selected":false,"expanded":false,"dirtyToggle":false,"AreaType":1,"TemplateId":"26dd88ec-f2e4-4fc4-b8e0-b1f75a63d724","DisplayName":"safe","Description":null,"id":"5ddfda9e-3886-4331-b658-df33e5dc5812","LocationId":"37e4434b-0d2c-47d0-8bef-033ea5bd28a2","Version":0,"IsDeleted":false,"TenantId":"f6f59624-018f-4a9c-89b2-96213966e4ec","RunSetData":null,"UserName":"Johnny Frederick","LastUpdateTime":1509054044662,"InstanceId":"5ddfda9e-3886-4331-b658-df33e5dc5812","SubmittedTime":1509053984068,"StartedTime":1509053986000,"EndedTime":1509054043000,"PlatformId":"Gamma2Platform8","CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509054043000}],"Points":[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}],"AlarmIds":null,"notficationIsPaused":false}');
            fixture.componentInstance.patrolPoints = JSON.parse('[{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"94b8824d-2546-470c-85cb-17bf0210a6c5","DisplayName":"Checkpoint 1","Description":null,"Ordinal":1,"Position":{"Coordinates":[-105.07332030683759,39.65030313088224],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053986000},{"Status":2,"ReportedTime":1509053994000}],"Actions":[{"CurrentStatus":2,"ActionId":"a2d9d1a2-cb89-4a0c-8020-4da287ca1e48","Command":3,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509053994000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"feafb14c-556d-460b-92b5-581bd943f5df","DisplayName":"Point 2","Description":null,"Ordinal":2,"Position":{"Coordinates":[-105.07328074425459,39.650302872735296],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509053994000},{"Status":2,"ReportedTime":1509054006000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"be5e41ce-f97c-4697-ac8e-3ba4a9622966","DisplayName":"Checkpoint 2","Description":null,"Ordinal":3,"Position":{"Coordinates":[-105.07328107953073,39.65027396026898],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054006000},{"Status":2,"ReportedTime":1509054016000}],"Actions":[{"CurrentStatus":2,"ActionId":"919b8b54-29e5-47b6-8c2a-5faa6ac9d746","Command":2,"Parameters":[],"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054016000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"17d05e71-ab8b-4ad6-9196-8ea5274994dc","DisplayName":"Point 4","Description":null,"Ordinal":4,"Position":{"Coordinates":[-105.0733233243227,39.65027370212191],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054016000},{"Status":2,"ReportedTime":1509054029000}],"Actions":[],"AlarmIds":null,"Telemetry":null},{"Selected":false,"IsInserted":false,"ActionsExpanded":false,"PointId":"b438afb3-5e5c-4cdd-804f-47b98cf93b76","DisplayName":"Checkpoint 3","Description":null,"Ordinal":5,"Position":{"Coordinates":[-105.0733008608222,39.65028893279768],"Type":"Point"},"CurrentStatus":2,"StatusHistory":[{"Status":1,"ReportedTime":1509054029000},{"Status":2,"ReportedTime":1509054038000}],"Actions":[{"CurrentStatus":2,"ActionId":"56160a89-c93e-4b82-9203-69f4f1830891","Command":26,"Parameters":[{"Name":5,"Value":"5","Type":0}],"StatusHistory":[{"Status":1,"ReportedTime":1509054038000},{"Status":2,"ReportedTime":1509054043000}],"AlarmIds":null,"Images":null,"HasSnapshots":false}],"AlarmIds":null,"Telemetry":null}]');
            
            // Act
            fixture.detectChanges();

            // Assert
            expect((fixture.componentInstance as any).getPoints().length).toEqual(5);
        });
    });
});